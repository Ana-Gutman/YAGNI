# ADR011: Incorporación de PM2 para la Gestión de Procesos en Producción
**Estado:** Aceptada  
**Participantes:** Federica Cabrera y Ana Gutman  

## Contexto
El sistema requiere una solución eficiente para la gestión de procesos, especialmente para manejar la escalabilidad y fiabilidad del servidor. Con el creciente tráfico y la necesidad de alta disponibilidad, se hace necesario optimizar el rendimiento y la resiliencia de las aplicaciones backend.

## Decisión
Se ha decidido incorporar **PM2** como gestor de procesos para la aplicación. PM2 permitirá:

- **Modo clúster con múltiples instancias**: Configuraremos la aplicación para que se ejecute en modo clúster, lo que distribuirá el tráfico entre varias instancias del servidor. Esto aprovechará múltiples núcleos de CPU, aumentando la capacidad de manejo de solicitudes concurrentes y mejorando el rendimiento general de la aplicación.
  
- **Reinicio automático en caso de fallos**: La configuración de PM2 incluirá un límite en el número de reinicios automáticos, asegurando que la aplicación se reinicie si falla, pero evitando ciclos infinitos de reinicio. Esta funcionalidad garantiza que el sistema mantenga su disponibilidad sin intervención manual, lo cual es clave para la estabilidad en producción.

- **Detección de cambios en el código**: PM2 está configurado para observar cambios en los archivos de la aplicación, reiniciando automáticamente la instancia cuando detecta modificaciones. Esto simplifica el ciclo de desarrollo, ya que los desarrolladores no tienen que reiniciar manualmente la aplicación después de cada cambio.

## Consecuencias
- **Beneficios:**  
  - **Escalabilidad:** El uso de PM2 en modo clúster permite que el sistema aproveche múltiples núcleos de la máquina, mejorando la capacidad de manejo de solicitudes concurrentes y aumentando el rendimiento de la aplicación.
  - **Alta Disponibilidad:** La capacidad de reiniciar automáticamente los procesos en caso de fallos (`max_restarts` y `restart_delay`) asegura que el sistema se mantenga operativo sin intervención manual, minimizando el tiempo de inactividad.
  - **Desarrollo Ágil:** La configuración de `watch` permite que PM2 reinicie automáticamente la aplicación cuando detecta cambios en los archivos fuente, lo cual facilita el ciclo de desarrollo sin necesidad de reiniciar manualmente la aplicación en cada cambio.
  - **Monitoreo y Mantenimiento:** PM2 ofrece funcionalidades integradas para monitorear el estado de las aplicaciones y gestionar los logs, lo que facilita la identificación de problemas y la optimización del rendimiento.
  La integración de PM2 en el proyecto no solo resuelve los desafíos de escalabilidad y alta disponibilidad, sino que también simplifica el monitoreo y la gestión de procesos. Esto permite que el sistema se mantenga estable, optimizando los recursos y reduciendo la intervención manual, lo cual es clave en entornos de producción con tráfico variable.

- **Costos:**  
  - **Recursos adicionales:** El modo clúster con múltiples instancias puede aumentar el consumo de memoria y CPU en máquinas con pocos recursos. Sin embargo, esta configuración está pensada para entornos de producción con suficiente capacidad de hardware.
  - **Configuración inicial:** Aunque PM2 ofrece facilidad de uso, se debe configurar correctamente el entorno y los parámetros de reinicio, especialmente en entornos de producción para evitar ciclos de reinicio innecesarios.

