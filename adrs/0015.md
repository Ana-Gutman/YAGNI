# ADR015: Implementación de WebSockets para la Gestión de Notificaciones de Lotes en Camiones y Monitores de Pedidos en Cocinas

**Estado:** Aprobado  
**Participantes:** Ana Gutman  

## CONTEXTO
En el sistema de gestión de pedidos y lotes, las cocinas deben recibir actualizaciones en tiempo real sobre el estado de los pedidos, mientras que los camiones también requieren notificaciones sobre los lotes que se están gestionando. Debido a la necesidad de transmitir estos datos de manera eficiente y en tiempo real, se evaluaron varias opciones, y se decidió implementar WebSockets para la transmisión de las notificaciones de los pedidos y lotes.

## DECISIÓN
Se decidió utilizar **WebSockets** para gestionar las notificaciones en tiempo real entre el **backend** y el **frontend** en el sistema de gestión de pedidos y lotes, en lugar de recurrir a técnicas tradicionales como polling o solicitudes HTTP repetidas.

### Justificación
- **Simplicidad en el backend**:
  - **Envío de mensajes directos**: El backend simplemente escucha los mensajes en las colas de RabbitMQ. Cuando una cocina recibe un mensaje, este se envía a través del WebSocket con el formato `{ id_cocina, ...pedidoData }`. Esta aproximación permite que el backend sea responsable solo de recibir y reenviar los datos sin tener que preocuparse por la gestión de la presentación de esos datos.
  - **Desacoplamiento de la lógica de presentación**: El backend no necesita gestionar la personalización de la información que llega a cada cliente. La lógica de presentación se delega completamente al frontend.

- **Flexibilidad en el frontend**:
  - **Filtrado en el frontend**: Los mensajes enviados desde el backend incluyen el `id_cocina`, lo que permite al frontend filtrar y decidir qué datos mostrar al usuario en función de qué cocina está asociada al cliente. Esta flexibilidad permite cambiar cómo se visualizan los datos sin necesidad de modificar el backend.
  - **Interactividad en tiempo real**: Los usuarios pueden ver las actualizaciones en tiempo real sin tener que hacer solicitudes adicionales al backend, lo que mejora la experiencia de usuario.

## CONSECUENCIAS
- **Beneficios**:
  - **Reducción de complejidad en el backend**: Al delegar el filtrado y la personalización de las notificaciones al frontend, el backend se mantiene sencillo y eficiente. Así se favorece su performance.
  - **Experiencia de usuario mejorada**: Los usuarios pueden ver las actualizaciones en tiempo real, lo que mejora la interacción con la aplicación.
  - **Escalabilidad y rendimiento**: El sistema es fácilmente escalable sin necesidad de modificaciones significativas, ya que no se acopla a las reglas de negocio del cliente, lo que facilita su mantenimiento a largo plazo.
  -  **Reducción de la latencia**: WebSockets proporcionan una conexión persistente que permite enviar y recibir datos de manera instantánea. Esto es ideal para sistemas que necesitan recibir notificaciones en tiempo real, como los monitores de pedidos en las cocinas y la gestión de lotes en los camiones.
  - **Menor sobrecarga de red**: A diferencia de las solicitudes HTTP, donde se necesita abrir una nueva conexión para cada petición, WebSockets mantienen una conexión persistente, reduciendo la sobrecarga de red y mejorando la eficiencia general.

- **Costos**:
  - **Requiere un manejo adecuado de conexiones WebSocket**: A medida que crece el número de clientes, es necesario gestionar las conexiones WebSocket de manera eficiente para evitar cuellos de botella.
  - **Posibles problemas de desconexión y reconexión**: Si un cliente pierde la conexión, es necesario implementar una estrategia para que el cliente se reconecte automáticamente y reciba las notificaciones adecuadas.
