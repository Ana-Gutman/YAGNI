# ADR0016: Uso de Redis para el Seguimiento de Reportes en Tiempo Real

## Estado:
Aceptada

## Participantes:
Federica Cabrera, Ana Gutman

## Contexto
La plataforma YAGNI requiere proporcionar información en tiempo real sobre el estado de los productos, inventarios y pedidos, en línea con los atributos de calidad como confiabilidad (AC1) y tiempo real (AC15). En particular, es necesario garantizar que las actualizaciones se reflejen en menos de un minuto y que el sistema sea capaz de soportar la carga asociada con consultas frecuentes. Redis, conocido por su velocidad y capacidades de caching y mensajería, ofrece una solución para gestionar estas actualizaciones de manera eficiente.

El uso de consultas directas a la base de datos para este propósito ha generado una latencia considerable y una carga innecesaria en el sistema, especialmente cuando múltiples usuarios realizan solicitudes simultáneas para datos similares. Esto motivó la evaluación de Redis como herramienta para optimizar el rendimiento.

## Decisión
Implementar Redis como middleware para el seguimiento de reportes en tiempo real, utilizando sus capacidades de:

- **Caching**: Almacenar temporalmente los datos más recientes de los reportes, como el estado de los productos o el inventario, para reducir la dependencia de la base de datos.
- **Pub/Sub**: Propagar eventos de actualizaciones en tiempo real a través de canales, permitiendo que los suscriptores reciban notificaciones de cambios sin necesidad de realizar polling.

## Opciones Consideradas
- **Polling con consultas directas a la base de datos**
  - **Rechazada**: Genera una carga excesiva en la base de datos y no cumple con los requerimientos de tiempo real.
  
- **Redis para caching y Pub/Sub**
  - **Aceptada**: Proporciona una solución eficiente para gestionar datos temporales y notificaciones en tiempo real con baja latencia.
  
- **RabbitMQ para comunicación en tiempo real**
  - **Rechazada**: Aunque RabbitMQ es efectivo para tareas asincrónicas, introduce una complejidad adicional para el almacenamiento y consulta de datos en tiempo real.

## Consecuencias

### Beneficios
- **Baja latencia**: Redis permite tiempos de respuesta de milisegundos para operaciones de lectura y escritura, asegurando que los datos estén disponibles en tiempo real.
- **Reducción de carga en la base de datos**: Las consultas frecuentes a datos reportados se resuelven desde Redis, liberando recursos de la base de datos relacional.
- **Propagación en tiempo real**: Con Pub/Sub, los suscriptores reciben actualizaciones inmediatas cuando cambian los datos, eliminando la necesidad de realizar polling continuo.
- **Simplicidad en la integración**: Redis es fácil de implementar y configurar en comparación con otras soluciones de mensajería más complejas.
- **Escalabilidad**: Redis maneja altos volúmenes de conexiones concurrentes, lo que lo hace adecuado para escenarios con múltiples usuarios monitoreando reportes en tiempo real.

### Costos
- **Consumo de memoria**: Redis almacena los datos en memoria, lo que puede ser costoso en términos de recursos en sistemas con grandes volúmenes de datos.
- **Expiración de datos**: Es necesario gestionar cuidadosamente los tiempos de vida (TTL) de los datos en el cache para evitar inconsistencias.
- **Dependencia en Redis**: El sistema dependerá del correcto funcionamiento de Redis para entregar reportes en tiempo real, lo que requiere monitoreo y respaldo adecuado.

## Detalles Técnicos
- **Caching de reportes**: Los reportes más recientes (por ejemplo, estado de productos o inventarios) se almacenan en Redis con claves únicas basadas en parámetros relevantes (e.g., `report:estado_producto:<productId>`). Los datos tienen un TTL configurado para garantizar que permanezcan actualizados.
  
- **Pub/Sub para actualizaciones**: Cuando un evento relevante ocurre (e.g., cambio de estado de un producto), un mensaje se publica en el canal correspondiente (e.g., `estado_producto_updates`). Los suscriptores (como el frontend) reciben estos mensajes en tiempo real para actualizar la interfaz del usuario.

- **Integración con el backend**: Los servicios del backend actualizan Redis cada vez que se modifican los datos subyacentes en la base de datos. Redis Pub/Sub notifica a los clientes suscritos sobre los cambios en los datos.

## Consecuencias de No Adoptar Redis
- **Latencia alta**: Las consultas directas a la base de datos para datos frecuentemente actualizados generan tiempos de respuesta más altos.
- **Carga innecesaria en la base de datos**: Un aumento en el número de usuarios concurrentes podría sobrecargar el sistema, afectando su confiabilidad.
- **Experiencia del usuario degradada**: La falta de notificaciones en tiempo real reduce la interactividad del sistema.

![imagen1Redis](https://github.com/IngSoft-AR/255163_260956/new/develop/adrs/foto1)
![imagen2Redis](https://github.com/IngSoft-AR/255163_260956/new/develop/adrs/foto2)
